# cs191w
This repository contains documentation and code for my CS191W project analyzing cutaneous squamous cell
carcinomas (cSCC) that present with perineural invasion (PNI) via single cell sequencing.

## Setup
### Software Dependencies
Ensure the following software is downloaded and accessible from the command line
* `snakemake`
* `cellranger`
* `bamtofastq`

### Data Download
#### Download the PNI data from our AWS bucket

Download the PNI FASTQs from the AWS bucket named `pni-scRNAseq`

#### Download the non-PNI data from Andrew Ji via SRA
`src/download_ji_bams.txt` contains a list of `wget` commands to download the relevant 10X BAMs from SRA.
The quickest way to download them is 

```
## Starting from project repo main directory
mkdir data/ji
cd data/ji
parallel -j 10 < ../../src/download_commands.txt
```

This will download the BAMs from SRA and place them in the appropriate directory. Be warned
that the full set of BAMs is several hundred GBs and may take a few hours.

#### Download reference files

### Preprocessing
#### Quantifying Ji's Data
The BAMs from Andrew Ji were generated by `cellranger` and must be converted to FASTQs so
cellranger can quantify them and produce abundance matrices.

Run the Snakemake pipeline to quantify Ji's data

```
snakemake -s preprocessing/preproc_ji.smk targets
```

#### Quantifying Our Data

We also need to run `cellranger` on our own data to generate abundance matrices

```
snakemake -s preprocessing/Snakefile targets
```

## Analysis
The following folders contain relevant analysis code. Each file has documentation
describing the purpose of that script.

* `src/comparative_analysis/` - scripts performing joint analysis on Ji's data with our own samples. The `harmony` folder contains analysis code
* `src/pni-only` - scripts only analyzing the PNI samples without Ji's data
* `src/figure-scripts` - scripts to generate figures for final report


